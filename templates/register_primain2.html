{% extends "base.html" %}
{% block title %}Register New Primain{% endblock %}
{% block content %}
<header>
    <h1>View Primain of Address</h1>
</header>
<main>
    <form id="primain-form" method="POST">
        <div class="field-with-button">
            <label for="address">Address:</label>
            <input type="text" id="address" name="address" placeholder="Enter your address" required>
            <button type="button" id="fetch-backend" class="small-button">View</button>
        </div>
        <div id="backend-response" style="display: none;">
            <!-- This is where the backend response will be displayed -->
            <div id="addressBox" style="background-color: #121212; color: #ffffff; border: 1px solid #5af0b9; border-radius: 5px; padding: 15px; margin-bottom: 10px; position: relative; width: fit-content;">
                <span id="addressValue"></span>
            </div>
            <button id="copyAddressButton" class="small-button" style="margin-top: 10px;" onclick="copyAddress()">Copy Primain</button>
        </div>
        <a href="/" class="back-button">Back</a>
    </form>
</main>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        document.getElementById("fetch-backend").addEventListener("click", function() {
            var address = document.getElementById("address").value;
            fetchBackendResponse(address);
        });
    });

    function fetchBackendResponse(address) {
        // Create a FormData object to send the address as form data
        var formData = new FormData();
        formData.append('address', address);

        // Make an AJAX request to the backend endpoint
        fetch('/register_primain2', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            // Display the backend response
            displayBackendResponse(data.primain);
        })
        .catch(error => {
            console.error('Error fetching backend response:', error);
            alert('Error fetching backend response');
        });
    }

    function displayBackendResponse(response) {
        var responseContainer = document.getElementById("backend-response");
        responseContainer.style.display = "block";
        document.getElementById('addressValue').textContent = response;
    }

    function copyAddress() {
        var addressValue = document.getElementById('addressValue');
        var range = document.createRange();
        range.selectNode(addressValue);
        window.getSelection().removeAllRanges();
        window.getSelection().addRange(range);
        document.execCommand('copy');
        window.getSelection().removeAllRanges();
        alert('Address copied to clipboard');
    }
</script>
{% endblock %}
